---

import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">-->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>
<!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">-->
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6">
    <div class="transition text-50 text-sm text-center">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}<!--. All Rights Reserved.
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> 
        <span class="split">|</span>
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>网站地图</a>
        -->
        <a target="_blank" href={url('sitemap-index.xml')}>网站地图</a>
        <span id="cdn-platform"></span>
        <br>
        <!--
        <a>CDN</a> <span id="cdn-platform"></span>
        Powered by
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
        -->
        <a href="https://beian.miit.gov.cn/" target="beian_blank">豫ICP备2026006191号-1</a>
        <!--
        <span class="split">|</span>
        <span><img src="/frame/images/ga.png" width="16px" class="mr-1"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=51060302510971" target="ga_blank" rel="nofollow noreferrer">川公网安备51060302510971号</a></span>
        -->
    </div>
</div>

<script>
async function detectCdnPlatform() {
    try {
        // 使用GET请求代替HEAD请求，在移动设备上更可靠
        const response = await fetch(window.location.href, {
            method: 'GET',
            credentials: 'same-origin',
            cache: 'no-cache',
            headers: {
                'Accept': 'text/html'
            }
        });
        
        // 获取server标头
        const serverHeader = response.headers.get('server');
        
        // 检测平台
        let platform = null;
        if (serverHeader) {
            if (serverHeader.includes('edgeone-pages')) {
                platform = 'edgeone-pages';
            } else if (serverHeader.toLowerCase().includes('cloudflare')) {
                platform = 'cloudflare';
            } else if (serverHeader.includes('Vercel')) {
                platform = 'vercel';
            }
        }
        
        // 显示对应图标
        const container = document.getElementById('cdn-platform');
        if (container && platform) {
            // 清除现有内容
            container.innerHTML = '';
            
            // 创建SVG图标
            const svg = document.createElement('img');
            svg.className = 'cdn-icon ml-2 inline-block align-middle';
            svg.style.height = '1em';
            svg.style.width = 'auto';
            svg.style.verticalAlign = 'middle';
            svg.style.display = 'inline-block';
            svg.style.maxWidth = '100%';
            svg.style.marginLeft = '4px';
            
            // 设置SVG路径
            let svgPath = '';
            switch (platform) {
                case 'edgeone-pages':
                    svgPath = '/assets/svg/edgeone-pages.svg';
                    break;
                case 'cloudflare':
                    svgPath = '/assets/svg/Cloudflare.svg';
                    break;
                case 'vercel':
                    svgPath = '/assets/svg/Vercel.svg';
                    break;
                default:
                    return;
            }
            
            // 设置SVG属性
            svg.src = svgPath;
            svg.alt = `${platform} CDN`;
            svg.loading = 'eager';
            
            // 处理加载错误
            svg.onerror = function() {
                console.error('CDN icon failed to load:', svgPath);
                // 错误时显示平台名称文本
                container.textContent = platform;
            };
            
            // 处理加载成功
            svg.onload = function() {
                console.log('CDN icon loaded successfully:', svgPath);
            };
            
            // 添加到容器
            container.appendChild(svg);
        } else if (container) {
            console.log('No CDN platform detected, server header:', serverHeader);
            // 尝试使用navigator.userAgent作为备用检测
            const userAgent = navigator.userAgent;
            console.log('User agent:', userAgent);
        }
    } catch (error) {
        console.error('CDN platform detection failed:', error);
        // 出错时尝试备用方案
        try {
            const container = document.getElementById('cdn-platform');
            if (container) {
                container.textContent = 'CDN';
            }
        } catch (e) {
            console.error('Fallback failed:', e);
        }
    }
}

// 页面加载后检测
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', detectCdnPlatform);
} else {
    detectCdnPlatform();
}

// 页面可见性变化时重新检测
if (typeof document !== 'undefined' && document.addEventListener) {
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            detectCdnPlatform();
        }
    });
    
    // 窗口加载完成后再次检测
    window.addEventListener('load', detectCdnPlatform);
}

// 添加延迟检测，确保在各种情况下都能运行
setTimeout(detectCdnPlatform, 1000);
setTimeout(detectCdnPlatform, 3000);
</script>